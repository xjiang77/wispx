<mxfile host="65bd71144e">
  <diagram id="gateway-modes" name="Gateway Modes">
    <mxGraphModel dx="828" dy="347" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <mxCell id="title" value="Clawdbot Gateway Modes (Local / Remote / Tailscale)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontStyle=1;fontSize=24;fontColor=#202124;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="20" width="880" height="44" as="geometry"/>
        </mxCell>

        <!-- Local mode panel -->
        <mxCell id="p_local" value="LOCAL MODE&#xa;(Gateway runs here)&#xa;bind: loopback/lan/auto" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;fillColor=#C6DAFC;strokeColor=#1A73E8;fontColor=#0D47A1;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="80" y="110" width="450" height="260" as="geometry"/>
        </mxCell>

        <mxCell id="local_gw" value="Gateway&#xa;WS+HTTP :18789&#xa;state: ~/.clawdbot" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;fillColor=#F1F3F4;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="120" y="180" width="180" height="120" as="geometry"/>
        </mxCell>

        <mxCell id="local_clients" value="Clients&#xa;(CLI/Web/Admin)" style="ellipse;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=3;fillColor=#FEEFC3;strokeColor=#E37400;fontColor=#5D4200;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="340" y="180" width="160" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="local_nodes" value="Nodes&#xa;(Mac/iOS/Android)" style="ellipse;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=3;fillColor=#CEEAD6;strokeColor=#188038;fontColor=#0B5323;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="340" y="260" width="160" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="e1" value="WS" style="edgeStyle=orthogonalEdgeStyle;rounded=1;sketch=1;curveFitting=1;jiggle=2;html=1;strokeWidth=2;strokeColor=#5F6368;" parent="1" source="local_clients" target="local_gw" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e2" value="WS role=node" style="edgeStyle=orthogonalEdgeStyle;rounded=1;sketch=1;curveFitting=1;jiggle=2;html=1;strokeWidth=2;strokeColor=#5F6368;" parent="1" source="local_nodes" target="local_gw" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Remote mode panel -->
        <mxCell id="p_remote" value="REMOTE MODE&#xa;(This machine is client-only)" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;fillColor=#FAD2CF;strokeColor=#C5221F;fontColor=#7F0000;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="560" y="110" width="960" height="260" as="geometry"/>
        </mxCell>

        <mxCell id="remote_client" value="Client machine&#xa;(CLI/App/Web)" style="ellipse;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=3;fillColor=#FEEFC3;strokeColor=#E37400;fontColor=#5D4200;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="610" y="200" width="180" height="90" as="geometry"/>
        </mxCell>

        <mxCell id="remote_server" value="Remote Gateway server&#xa;ws(s)://host:18789" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;fillColor=#F1F3F4;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="1010" y="180" width="220" height="120" as="geometry"/>
        </mxCell>

        <mxCell id="remote_nodes" value="Nodes connect&#xa;over WS role=node" style="ellipse;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=3;fillColor=#CEEAD6;strokeColor=#188038;fontColor=#0B5323;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="1260" y="190" width="220" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="e3" value="WS connect + auth" style="edgeStyle=orthogonalEdgeStyle;rounded=1;sketch=1;curveFitting=1;jiggle=2;html=1;strokeWidth=2;strokeColor=#5F6368;" parent="1" source="remote_client" target="remote_server" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e4" value="WS" style="edgeStyle=orthogonalEdgeStyle;rounded=1;sketch=1;curveFitting=1;jiggle=2;html=1;strokeWidth=2;strokeColor=#5F6368;" parent="1" source="remote_nodes" target="remote_server" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Tailscale overlay -->
        <mxCell id="p_ts" value="TAILSCALE (optional)&#xa;serve: tailnet only&#xa;funnel: public HTTPS (password required)" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;dashed=1;fillColor=#DADCE0;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="80" y="410" width="1440" height="220" as="geometry"/>
        </mxCell>

        <mxCell id="ts_note" value="Constraints:&#xa;1) non-loopback bind requires auth&#xa;2) tailscale serve/funnel requires bind=loopback&#xa;3) funnel requires auth=password" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;strokeWidth=2;fillColor=#F1F3F4;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="120" y="470" width="520" height="130" as="geometry"/>
        </mxCell>

        <mxCell id="ts_flow" value="HTTPS via tailscale" style="edgeStyle=orthogonalEdgeStyle;rounded=1;sketch=1;curveFitting=1;jiggle=2;html=1;strokeWidth=2;dashed=1;strokeColor=#5F6368;" parent="1" source="remote_client" target="local_gw" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
