<mxfile host="65bd71144e">
  <diagram id="v5" name="Clawdbot v5 Main">
    <mxGraphModel dx="1200" dy="800" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="Clawdbot Architecture (v5) — Agent-centric, clear modes + tool loop" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontStyle=1;fontSize=24;fontColor=#202124;sketch=0;" parent="1" vertex="1">
          <mxGeometry x="240" y="18" width="1120" height="40" as="geometry"/>
        </mxCell>

        <!-- COLUMN PANELS: Entry | Gateway | Agent Runtime | Infra -->
        <mxCell id="p_entry" value="ENTRY (Channels / UIs)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFF4D6;strokeColor=#E37400;fontColor=#5D4200;fontStyle=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="40" y="90" width="300" height="760" as="geometry"/>
        </mxCell>

        <mxCell id="p_gw" value="GATEWAY (WS/HTTP)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#D7E6FE;strokeColor=#1A73E8;fontColor=#0D47A1;fontStyle=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="360" y="90" width="360" height="760" as="geometry"/>
        </mxCell>

        <mxCell id="p_agent" value="AGENT RUNTIME (core)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#D9F2E0;strokeColor=#188038;fontColor=#0B5323;fontStyle=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="740" y="90" width="540" height="760" as="geometry"/>
        </mxCell>

        <mxCell id="p_infra" value="INFRA / STORES (servant utilities)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#F1F3F4;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1300" y="90" width="260" height="760" as="geometry"/>
        </mxCell>

        <!-- ENTRY NODES -->
        <mxCell id="entry_ch" value="Channels\nTelegram / WhatsApp" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="70" y="160" width="240" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="entry_ui" value="Control UIs\nCLI / Web UI" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="70" y="250" width="240" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="entry_nodes" value="Nodes\n(macOS / iOS / Android)" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="70" y="340" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- GATEWAY CORE -->
        <mxCell id="gw_core" value="Gateway daemon\n- Channel manager\n- Node mgmt + pairing\n- Cron + events\nPorts: WS/HTTP 18789" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFFFFF;strokeColor=#1A73E8;fontColor=#0D47A1;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="385" y="160" width="310" height="140" as="geometry"/>
        </mxCell>

        <!-- Gateway Modes panel -->
        <mxCell id="gw_modes" value="Gateway Modes (deployment)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#E8F0FE;strokeColor=#1A73E8;fontColor=#0D47A1;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="385" y="330" width="310" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="gw_local" value="LOCAL\nThis machine runs Gateway\nstate: ~/.clawdbot" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="400" y="370" width="145" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="gw_remote" value="REMOTE\nThis machine is client-only\nconnect: ws(s)://host:18789" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="550" y="370" width="145" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="gw_ts" value="TAILSCALE overlay\nserve: tailnet only\nfunnel: public + password" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="400" y="450" width="295" height="60" as="geometry"/>
        </mxCell>

        <!-- AGENT RUNTIME CORE BLOCKS -->
        <mxCell id="agent_core" value="Agent core\nSession + Context + Memory\nProvider router + Streaming" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#FFFFFF;strokeColor=#188038;fontColor=#0B5323;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="770" y="160" width="480" height="110" as="geometry"/>
        </mxCell>

        <!-- TOOL LOOP PANEL inside agent -->
        <mxCell id="loop_panel" value="ReAct-like Tool Loop (runtime executes)" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;sketch=0;fillColor=#E6F4EA;strokeColor=#188038;fontColor=#0B5323;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="770" y="290" width="480" height="260" as="geometry"/>
        </mxCell>

        <mxCell id="loop_steps" value="LLM → tool request → pre-check (hooks/policy/approval) → exec → post-log → observation → LLM → final reply" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="790" y="330" width="440" height="60" as="geometry"/>
        </mxCell>

        <!-- Example cards -->
        <mxCell id="ex_code" value="Code Exec (example)\n{\"tool\":\"bash\",\"args\":{\"command\":\"pytest -q\"}}\nresult: exit=0 + summary" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="790" y="405" width="210" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="ex_browser" value="Browser (example)\n{\"tool\":\"browser.snapshot\"}\nrefs: aria-*\nextract fields" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="1010" y="405" width="220" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="ex_file" value="File Ops (example)\n{\"tool\":\"edit\",\"args\":{...}}\nresult: diff/ok" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="790" y="535" width="440" height="50" as="geometry"/>
        </mxCell>

        <!-- INFRA NODES -->
        <mxCell id="infra_config" value="Config" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="170" width="210" height="50" as="geometry"/></mxCell>
        <mxCell id="infra_logging" value="Logging / Audit" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="230" width="210" height="50" as="geometry"/></mxCell>
        <mxCell id="infra_sandbox" value="Tool Sandbox" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="290" width="210" height="50" as="geometry"/></mxCell>
        <mxCell id="infra_store" value="Memory Store" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="350" width="210" height="50" as="geometry"/></mxCell>
        <mxCell id="infra_sessions" value="Sessions" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="410" width="210" height="50" as="geometry"/></mxCell>
        <mxCell id="infra_hooks" value="Hooks\nPreToolUse/PostToolUse" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=1;sketch=0;fillColor=#FFFFFF;strokeColor=#5F6368;fontColor=#202124;fontStyle=1;fontSize=12;" parent="1" vertex="1"><mxGeometry x="1325" y="470" width="210" height="60" as="geometry"/></mxCell>

        <!-- MAIN FLOW EDGES (no crossings) -->
        <mxCell id="e_ch" value="message" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=2;strokeColor=#5F6368;sketch=0;" parent="1" source="entry_ch" target="gw_core" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e_ui" value="control" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=2;strokeColor=#5F6368;sketch=0;" parent="1" source="entry_ui" target="gw_core" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e_nodes" value="ws role=node" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=2;strokeColor=#5F6368;sketch=0;" parent="1" source="entry_nodes" target="gw_core" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>

        <mxCell id="e_gw_agent" value="events + context" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=2;strokeColor=#5F6368;sketch=0;" parent="1" source="gw_core" target="agent_core" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>

        <mxCell id="e_agent_infra" value="uses" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=2;strokeColor=#5F6368;dashed=1;sketch=0;" parent="1" source="agent_core" target="infra_config" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>

        <!-- subtle edges from loop to infra logging/hooks -->
        <mxCell id="e_loop_hooks" value="policy" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=1;strokeColor=#5F6368;dashed=1;sketch=0;" parent="1" source="loop_steps" target="infra_hooks" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e_loop_log" value="audit" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;strokeWidth=1;strokeColor=#5F6368;dashed=1;sketch=0;" parent="1" source="loop_steps" target="infra_logging" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
